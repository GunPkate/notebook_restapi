var express = require('express')
var {Router, request} = require('express')
const mongoose = require('mongoose')
const router = express.Router();

// mongoose.connect('mongodb://localhost:27017/my_assets');
mongoose.connect('mongodb://localhost/my_assets')
    .then(()=>console.log('connected to MongoDB'))
        .catch(()=>console.error('Connection error: ',error));

    const notebookSchema = new mongoose.Schema({

        asset_code:{     type: String,require: true},
        brand:{         type: String,require: true   },
        model:{        type: String,require: true},
        serial:{        type: String,require: true},
        status:{        type: Boolean,require: true},
        waranty:{       type: Number,require: true},
        purchase_date:{  type: Date,require: true},
        remark:{        type: String,}
    },
    { collection:'notebooks',versionKey: false}
    )

    const Notebooks = mongoose.model('notebooks',notebookSchema)

router.get('/notebook/getall',(req,res)=>{
    try {
        Notebooks.find({},function(error,findallnotebook){
            const result = findallnotebook;
            console.log("result: ",result);
            res.status(200).json(({
                resultCode: 20000,
                resultDescription: "success",
                resultData: result
            }));
        });
    } catch (error) {
        console.log("get api error",error)
    }
})

router.post('/notebook/create', async (req,res)=>{
    try {
    // console.log(req.body.brand);
    const data = req.body
    // console.log(body,"here");
    // Notebooks.find({"brand":`${req.body.brand}`,"serial":`${req.body.serial}`},(error,find_result)=>{

        //  Notebooks.find({"brand":`${req.body.brand}`},async (error,find_result)=>{
        //     console.log(find_result)
        //     if(find_result){
        //         res.send({
        //             "resultcode": 40900,
        //             "resultDescription": "Duplicated data",
        //         })
        //     }else{
                
                  const creatednotebook = await Notebooks.create( {      
                    "brand" : data.brand,
                    "asset_code": data.asset_code,
                    "moidel" : data.model,
                    "serial" : data.serial,
                    "status": data.status,
                    "waranty" : data.status,
                    "purchase_date": Date.now(),
                    "remark": data.remark
                })
                console.log("created",creatednotebook)
                res.status(200).json({
                    resultCode: 20000,
                    resultDescription: error.message
                })
            // }
        // })
    } catch (error) {
        res.status(500).json({
            resultCode: 50000,
            resultDescription: error.message
        })
    }
})

router.put('/notebook/update',(req,res)=>{
    const {asset_code} = req.body ,data = req.body
    // console.log(req.body)
    Notebooks.findOneAndUpdate({asset_code:asset_code},{
        "brand" : data.brand,
        "asset_code": data.asset_code,
        "model" : data.model,
        "serial" : data.serial,
        "status": data.status,
        "waranty" : data.status,
        "remark": data.remark
    },(err,founddata)=>{
        // console.log(founddata)
        res.send(res.statusCode(200).json({
            resultCode: 20000,
            resultDescription: "Update Success",
            resultData: founddata
        }))
    })
})

module.exports = router;